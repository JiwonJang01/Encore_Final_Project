<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>선의 거리 계산하기</title>
    <style>
.dot {overflow:hidden;float:left;width:12px;height:12px;background: url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/mini_circle.png');}
.dotOverlay {position:relative;bottom:10px;border-radius:6px;border: 1px solid #ccc;border-bottom:2px solid #ddd;float:left;font-size:12px;padding:5px;background:#fff;}
.dotOverlay:nth-of-type(n) {border:0; box-shadow:0px 1px 2px #888;}
.number {font-weight:bold;color:#ee6152;}
.dotOverlay:after {content:'';position:absolute;margin-left:-6px;left:50%;bottom:-8px;width:11px;height:8px;background:url('https://t1.daumcdn.net/localimg/localimages/07/mapapidoc/vertex_white_small.png')}
.distanceInfo {position:relative;top:5px;left:5px;list-style:none;margin:0;}
.distanceInfo .label {display:inline-block;width:50px;}
.distanceInfo:after {content:none;}
</style>
</head>
<body>
<div id="map" style="width:100%;height:350px;"></div>

<script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=64ca09990c4ef115e5bdda00a2c4bc44"></script>
<script>
var mapContainer = document.getElementById('map'), // 지도를 표시할 div
    mapOption = {
        center: new kakao.maps.LatLng(33.450701, 126.570667), // 지도의 중심좌표
        level: 3 // 지도의 확대 레벨
    };

var map = new kakao.maps.Map(mapContainer, mapOption); // 지도를 생성합니다

var drawingFlag = false; // 선이 그려지고 있는 상태를 가지고 있을 변수입니다
var moveLine; // 선이 그려지고 있을때 마우스 움직임에 따라 그려질 선 객체 입니다
var clickLine // 마우스로 클릭한 좌표로 그려질 선 객체입니다
var distanceOverlay; // 선의 거리정보를 표시할 커스텀오버레이 입니다
var dots = {}; // 선이 그려지고 있을때 클릭할 때마다 클릭 지점과 거리를 표시하는 커스텀 오버레이 배열입니다.

// 지도에 클릭 이벤트를 등록합니다
// 지도를 클릭하면 선 그리기가 시작됩니다 그려진 선이 있으면 지우고 다시 그립니다
kakao.maps.event.addListener(map, 'click', function(mouseEvent) {

    // 마우스로 클릭한 위치입니다
    var clickPosition = mouseEvent.latLng;

    // 지도 클릭이벤트가 발생했는데 선을 그리고있는 상태가 아니면
    if (!drawingFlag) {

        // 상태를 true로, 선이 그리고있는 상태로 변경합니다
        drawingFlag = true;

        // 지도 위에 선이 표시되고 있다면 지도에서 제거합니다
        deleteClickLine();

        // 지도 위에 커스텀오버레이가 표시되고 있다면 지도에서 제거합니다
        deleteDistnce();

        // 지도 위에 선을 그리기 위해 클릭한 지점과 해당 지점의 거리정보가 표시되고 있다면 지도에서 제거합니다
        deleteCircleDot();

        // 클릭한 위치를 기준으로 선을 생성하고 지도위에 표시합니다
        clickLine = new kakao.maps.Polyline({
            map: map, // 선을 표시할 지도입니다
            path: [clickPosition], // 선을 구성하는 좌표 배열입니다 클릭한 위치를 넣어줍니다
            strokeWeight: 3, // 선의 두께입니다
            strokeColor: '#db4040', // 선의 색깔입니다
            strokeOpacity: 1, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
            strokeStyle: 'solid' // 선의 스타일입니다
        });

        // 선이 그려지고 있을 때 마우스 움직임에 따라 선이 그려질 위치를 표시할 선을 생성합니다
        moveLine = new kakao.maps.Polyline({
            strokeWeight: 3, // 선의 두께입니다
            strokeColor: '#db4040', // 선의 색깔입니다
            strokeOpacity: 0.5, // 선의 불투명도입니다 0에서 1 사이값이며 0에 가까울수록 투명합니다
            strokeStyle: 'solid' // 선의 스타일입니다
        });

        // 클릭한 지점에 대한 정보를 지도에 표시합니다
        displayCircleDot(clickPosition, 0);


    } else { // 선이 그려지고 있는 상태이면

        // 그려지고 있는 선의 좌표 배열을 얻어옵니다
        var path = clickLine.getPath();

        // 좌표 배열에 클릭한 위치를 추가합니다
        path.push(clickPosition);

        // 다시 선에 좌표 배열을 설정하여 클릭 위치까지 선을 그리도록 설정합니다
        clickLine.setPath(path);

        var distance = Math.round(clickLine.getLength());
        displayCircleDot(clickPosition, distance);
    }
});

// 지도에 마우스무브 이벤트를 등록합니다
// 선을 그리고있는 상태에서 마우스무브 이벤트가 발생하면 그려질 선의 위치를 동적으로 보여주도록 합니다
kakao.maps.event.addListener(map, 'mousemove', function (mouseEvent) {

    // 지도 마우스무브 이벤트가 발생했는데 선을 그리고있는 상태이면
    if (drawingFlag){

        // 마우스 커서의 현재 위치를 얻어옵니다
        var mousePosition = mouseEvent.latLng;

        // 마우스 클릭으로 그려진 선의 좌표 배열을 얻어옵니다
        var path = clickLine.getPath();

        // 마우스 클릭으로 그려진 마지막 좌표와 마우스 커서 위치의 좌표로 선을 표시합니다
        var movepath = [path[path.length-1], mousePosition];
        moveLine.setPath(movepath);
        moveLine.setMap(map);

        var distance = Math.round(clickLine.getLength() + moveLine.getLength()), // 선의 총 거리를 계산합니다
            content = '<div class="dotOverlay distanceInfo">총거리 <span class="number">' + distance + '</span>m</div>'; // 커스텀오버레이에 추가될 내용입니다

        // 거리정보를 지도에 표시합니다
        showDistance(content, mousePosition);
    }
});

// 지도에 마우스 오른쪽 클릭 이벤트를 등록합니다
// 선을 그리고있는 상태에서 마우스 오른쪽 클릭 이벤트가 발생하면 선 그리기를 종료합니다
kakao.maps.event.addListener(map, 'rightclick', function (mouseEvent) {

    // 지도 오른쪽 클릭 이벤트가 발생했는데 선을 그리고있는 상태이면
    if (drawingFlag) {

        // 마우스무브로 그려진 선은 지도에서 제거합니다
        moveLine.setMap(null);
        moveLine = null;

        // 마우스 클릭으로 그린 선의 좌표 배열을 얻어옵니다
        var path = clickLine.getPath();

        // 선을 구성하는 좌표의 개수가 2개 이상이면
        if (path.length > 1) {

            // 마지막 클릭 지점에 대한 거리 정보 커스텀 오버레이를 지웁니다
            if (dots[dots.length-1].distance) {
                dots[dots.length-1].distance.setMap(null);
                dots[dots.length-1].distance = null;
            }

            var distance = Math.round(clickLine.getLength()), // 선의 총 거리를 계산합니다
                content = getTimeHTML(distance); // 커스텀오버레이에 추가될 내용입니다

            // 그려진 선의 거리정보를 지도에 표시합니다
            showDistance(content, path[path.length-1]);

        } else {

            // 선을 구성하는 좌표의 개수가 1개 이하이면
            // 지도에 표시되고 있는 선과 정보들을 지도에서 제거합니다.
            deleteClickLine();
            deleteCircleDot();
            deleteDistnce();

        }

        // 상태를 false로, 그리지 않고 있는 상태로 변경합니다
        drawingFlag = false;
    }
});

// 클릭으로 그려진 선을 지도에서 제거하는 함수입니다
function deleteClickLine() {
    if (clickLine) {
        clickLine.setMap(null);
        clickLine = null;
    }
}

// 마우스 드래그로 그려지고 있는 선의 총거리 정보를 표시하거
// 마우스 오른쪽 클릭으로 선 그리가 종료됐을 때 선의 정보를 표시하는 커스텀 오버레이를 생성하고 지도에 표시하는 함수입니다
function showDistance(content, position) {

    if (distanceOverlay) { // 커스텀오버레이가 생성된 상태이면

        // 커스텀 오버레이의 위치와 표시할 내용을 설정합니다
        distanceOverlay.setPosition(position);
        distanceOverlay.setContent(content);

    } else { // 커스텀 오버레이가 생성되지 않은 상태이면

        // 커스텀 오버레이를 생성하고 지도에 표시합니다
        distanceOverlay = new kakao.maps.CustomOverlay({
            map: map, // 커스텀오버레이를 표시할 지도입니다
            content: content,  // 커스텀오버레이에 표시할 내용입니다
            position: position, // 커스텀오버레이를 표시할 위치입니다.
            xAnchor: 0,
            yAnchor: 0,
            zIndex: 3
        });
    }
}

// 그려지고 있는 선의 총거리 정보와
// 선 그리가 종료됐을 때 선의 정보를 표시하는 커스텀 오버레이를 삭제하는 함수입니다
function deleteDistnce () {
    if (distanceOverlay) {
        distanceOverlay.setMap(null);
        distanceOverlay = null;
    }
}

// 선이 그려지고 있는 상태일 때 지도를 클릭하면 호출하여
// 클릭 지점에 대한 정보 (동그라미와 클릭 지점까지의 총거리)를 표출하는 함수입니다
function displayCircleDot(position, distance) {

    // 클릭 지점을 표시할 빨간 동그라미 커스텀오버레이를 생성합니다
    var circleOverlay = new kakao.maps.CustomOverlay({
        content: '<span class="dot"></span>',
        position: position,
        zIndex: 1
    });

    // 지도에 표시합니다
    circleOverlay.setMap(map);

    if (distance > 0) {
        // 클릭한 지점까지의 그려진 선의 총 거리를 표시할 커스텀 오버레이를 생성합니다
        var distanceOverlay = new kakao.maps.CustomOverlay({
            content: '<div class="dotOverlay">거리 <span class="number">' + distance + '</span>m</div>',
            position: position,
            yAnchor: 1,
            zIndex: 2
        });

        // 지도에 표시합니다
        distanceOverlay.setMap(map);
    }

    // 배열에 추가합니다
    dots.push({circle:circleOverlay, distance: distanceOverlay});
}

// 클릭 지점에 대한 정보 (동그라미와 클릭 지점까지의 총거리)를 지도에서 모두 제거하는 함수입니다
function deleteCircleDot() {
    var i;

    for ( i = 0; i < dots.length; i++ ){
        if (dots[i].circle) {
            dots[i].circle.setMap(null);
        }

        if (dots[i].distance) {
            dots[i].distance.setMap(null);
        }
    }

    dots = [];
}

// 마우스 우클릭 하여 선 그리기가 종료됐을 때 호출하여
// 그려진 선의 총거리 정보와 거리에 대한 도보, 자전거 시간을 계산하여
// HTML Content를 만들어 리턴하는 함수입니다
function getTimeHTML(distance) {

    // 도보의 시속은 평균 4km/h 이고 도보의 분속은 67m/min입니다
    var walkkTime = distance / 67 | 0;
    var walkHour = '', walkMin = '';

    // 계산한 도보 시간이 60분 보다 크면 시간으로 표시합니다
    if (walkkTime > 60) {
        walkHour = '<span class="number">' + Math.floor(walkkTime / 60) + '</span>시간 '
    }
    walkMin = '<span class="number">' + walkkTime % 60 + '</span>분'

    // 자전거의 평균 시속은 16km/h 이고 이것을 기준으로 자전거의 분속은 267m/min입니다
    var bycicleTime = distance / 227 | 0;
    var bycicleHour = '', bycicleMin = '';

    // 계산한 자전거 시간이 60분 보다 크면 시간으로 표출합니다
    if (bycicleTime > 60) {
        bycicleHour = '<span class="number">' + Math.floor(bycicleTime / 60) + '</span>시간 '
    }
    bycicleMin = '<span class="number">' + bycicleTime % 60 + '</span>분'

    // 거리와 도보 시간, 자전거 시간을 가지고 HTML Content를 만들어 리턴합니다
    var content = '<ul class="dotOverlay distanceInfo">';
    content += '    <li>';
    content += '        <span class="label">총거리</span><span class="number">' + distance + '</span>m';
    content += '    </li>';
    content += '    <li>';
    content += '        <span class="label">도보</span>' + walkHour + walkMin;
    content += '    </li>';
    content += '    <li>';
    content += '        <span class="label">자전거</span>' + bycicleHour + bycicleMin;
    content += '    </li>';
    content += '</ul>'

    return content;
}

</script>
</body>
</html>

<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kakao API 주소 검색 모달</title>
    <!-- 부트스트랩 CSS -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <!-- 부트스트랩 JavaScript 및 jQuery -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <style>
        #addressResults {
            max-height: 400px; /* 원하는 높이로 조정 가능 */
            overflow-y: auto;
        }
    </style>
</head>
<body>

<!-- 장소 추가 버튼 -->
<button type="button" id="openModalButton" class="btn btn-primary">장소 추가</button>

<!-- 모달 -->
<div class="modal" id="addressModal">
    <div class="modal-dialog">
        <div class="modal-content">
            <!-- 모달 헤더 -->
            <div class="modal-header">
                <h5 class="modal-title">주소 검색</h5>
                <button type="button" class="close" data-dismiss="modal">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <!-- 모달 바디 -->
            <div class="modal-body">
                <div class="input-group">
                    <input type="text" id="addressInput" class="form-control" placeholder="주소를 입력하세요">
                    <div class="input-group-append">
                        <button type="button" id="searchButton" class="btn btn-primary">검색</button>
                    </div>
                </div>
                <div id="addressResults" class="overflow-auto mt-3"></div>
            </div>
        </div>
    </div>
</div>

<!-- 선택한 장소 리스트 -->
<div id="selectedPlaces" class="mt-3">
    <h5>선택한 장소 리스트</h5>
    <ul id="placesList1" class="list-group"></ul>
</div>

<script>
    // Kakao API 키
    const kakaoApiKey = '1ca1474a66a4cd0fdd5d9e5a9e020070';
    let selectedPlaces = []; // 선택한 장소를 저장할 배열

    // 장소 추가 버튼 클릭 이벤트 처리
    document.getElementById('openModalButton').addEventListener('click', function() {
        // 모달 표시
        $('#addressModal').modal('show');
    });

    // 모달이 닫힐 때 초기화
    $('#addressModal').on('hidden.bs.modal', function () {
        $('#addressInput').val('');
        $('#addressResults').empty();
    });

    // 검색 버튼 클릭 이벤트 처리
    document.getElementById('searchButton').addEventListener('click', function() {
        const addressInput = document.getElementById('addressInput').value;

        // Kakao API 호출 URL
        const apiUrl = `https://dapi.kakao.com/v2/local/search/keyword.json?query=${encodeURIComponent(addressInput)}`;

        // Ajax 요청
        fetch(apiUrl, {
            headers: {
                'Authorization': `KakaoAK ${kakaoApiKey}`
            }
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Kakao API 요청에 실패했습니다.');
            }
            return response.json();
        })
        .then(data => {
            // 검색 결과를 처리하는 로직
            const resultsDiv = document.getElementById('addressResults');
            resultsDiv.innerHTML = ''; // 기존 결과 초기화

            if (data.documents && data.documents.length > 0) {
                data.documents.forEach(item => {
                    const address = item.address_name || '주소 정보 없음';
                    const placeName = item.place_name || '장소 이름 없음';
                    const resultElement = document.createElement('div');
                    resultElement.className = 'd-flex justify-content-between align-items-center border p-2';
                    resultElement.innerHTML = `
                        <span>[${placeName}] ${address}</span>
                        <button type="button" class="btn btn-sm btn-success addPlaceButton">추가</button>
                    `;
                    resultElement.querySelector('.addPlaceButton').addEventListener('click', function() {
                        addPlace(placeName, address);
                    });
                    resultsDiv.appendChild(resultElement);
                });
            } else {
                resultsDiv.textContent = '검색 결과가 없습니다.';
            }
        })
        .catch(error => {
            console.error('주소 검색 중 오류가 발생했습니다.', error);
            const resultsDiv = document.getElementById('addressResults');
            resultsDiv.textContent = '주소 검색 중 오류가 발생했습니다.';
        });
    });

    // 선택한 장소를 추가하는 함수
    function addPlace(placeName, address) {
        const placesList = document.getElementById('placesList');
        const placeItem = document.createElement('li');
        placeItem.className = 'list-group-item';
        placeItem.textContent = `[${placeName}] ${address}`;
        placesList.appendChild(placeItem);

        // 선택한 장소를 배열에 추가
        selectedPlaces.push({ placeName, address });

        // 모달을 닫음
        $('#addressModal').modal('hide');
    }
</script>

</body>
</html>











<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Modal Example</title>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <!-- jQuery --><script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <!-- Bootstrap JS -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.bundle.min.js"></script>
</head>
<body>

<div class="container">
  <h2>카테고리 선택하기</h2>
  <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#categoryModal">
    Select Categories
  </button>
</div>

<!-- Modal -->
<div class="modal fade" id="categoryModal" tabindex="-1" role="dialog" aria-labelledby="categoryModalLabel" aria-hidden="true" data-backdrop="false">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="categoryModalLabel">카테고리 선택</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <form id="categoryForm" method="GET" action="{% url 'get_data' %}">
          <div class="form-group">
            <label for="selectCategory1">대분류</label>
            <select class="form-control" id="selectCategory1", name="cat1_code" onchange="fetchMiddleCategories()">
              <option value="">select</option>
                {% for largecategory in largecategories %}
                <option value="{{ largecategory.code }}">{{ largecategory.name }}</option>
                {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="selectCategory2">중분류</label>
            <select class="form-control" id="selectCategory2", name="cat2_code" onchange="fetchSmallCategories()">
              <option value="">select</option>
                {% for middlecategory  in middlecategories %}
                <option value="{{ middlecategory.code }}">{{ middlecategory.name }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="form-group">
            <label for="selectCategory3">소분류</label>
            <select class="form-control" id="selectCategory3">
              <option value="">select</option>
                {% for smallcategory  in smallcategories %}
                <option value="{{ smallcategory.code }}">{{ samllcategory.name }}</option>
              {% endfor %}
            </select>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" onclick="saveCategory()">Save changes</button>
      </div>
    </div>
  </div>
</div>

<script>
function fetchMiddleCategories() {
    var largeCategory = document.getElementById('selectCategory1').value;
    var middleCategorySelect = document.getElementById('selectCategory2');
    middleCategorySelect.innerHTML = '<option value="">select</option>'; // 초기화

$.ajax({
        url: '/middlecategory/',
        type: 'GET',
        data: {
            'cat1_code': largeCategory
        },
        success: function(data) {
            data.middlecategories.forEach(function(category) {
                var option = document.createElement('option');
                option.value = category.code;
                option.textContent = category.name;
                middleCategorySelect.appendChild(option);
            });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching middle categories:', error);
        }
    });
 }

function fetchSmallCategories() {
    var middleCategory = document.getElementById('selectCategory2').value;
    var smallCategorySelect = document.getElementById('selectCategory3');
    smallCategorySelect.innerHTML = '<option value="">select</option>'; // 초기화

$.ajax({
        url: '/smallcategory/',
        type: 'GET',
        data: {
            'cat2_code': middleCategory
        },
        success: function(data) {
            data.smallcategories.forEach(function(category) {
                var option = document.createElement('option');
                option.value = category.code;
                option.textContent = category.name;
                smallCategorySelect.appendChild(option);
            });
        },
        error: function(xhr, status, error) {
            console.error('Error fetching middle categories:', error);
        }
    });
 }




/*
    // AJAX 요청을 통해 중분류 데이터를 가져옴
    fetch(`/map/?cat1_code=${largeCategory}`)
        .then(data => {
            data.middlecategories.forEach(function(category) {
                var option = document.createElement('option');
                option.value = category.code;
                option.text = category.name;
                middleCategorySelect.appendChild(option);
            });
        })
        .catch(error => console.error('Error fetching small categories:', error));


 */

</script>

</body>
</html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Location Selector</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#locationModal">
            Select Location
        </button>

        <!-- Modal -->
        <div class="modal fade" id="locationModal" tabindex="-1" aria-labelledby="locationModalLabel" aria-hidden="true" data-backdrop="false">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="locationModalLabel">Select Location</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <form>
                            <div class="form-group">
                                <label for="provinceSelect">광역시/도</label>
                                <select id="provinceSelect" class="form-control" onchange="fetchCities()">
                                    <option value="">select</option>
                                    {% for Areacode  in Areacodes %}
                                    <option value="{{ Areacode.code }}">{{ Areacode.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="citySelect">시/군/구</label>
                                <select id="citySelect" class="form-control">
                                    {% for citydistrict  in citydistricts %}
                                    <option value="{{ citydistrict.code }}">{{ citydistrict.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" onclick="saveLocation()">Save changes</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="placesList" class="mt-4">
            <h2>Places</h2>
            <ul id="places">
                <!-- 장소 리스트가 여기에 동적으로 추가됩니다 -->
            </ul>
        </div>
    </div>

<!-- jQuery --><script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
        function fetchCities() {
    var AreaCode = document.getElementById('provinceSelect').value;
    var citydistrictSelect = document.getElementById('citySelect');
    citydistrictSelect.innerHTML = '<option value="">select</option>'; // 초기화

    $.ajax({
            url: '/citydistrict/',
            type: 'GET',
            data: {
                'areacode': AreaCode
            },
            success: function(data) {
                data.citydistricts.forEach(function(city) {
                    var option = document.createElement('option');
                    option.value = city.code;
                    option.textContent = city.name;
                    citydistrictSelect.appendChild(option);
                });
            },
            error: function(xhr, status, error) {
                console.error('Error fetching citydistrict:', error);
            }
        });
     }

        function saveLocation() {
            selectedProvince = document.getElementById('provinceSelect').value;
            selectedCity = document.getElementById('citySelect').value;
            $('#locationModal').modal('hide');
        }

        function saveCategory() {
            selectedCategory1 = document.getElementById('selectCategory1').value;
            selectedCategory2 = document.getElementById('selectCategory2').value;
            selectedCategory3 = document.getElementById('selectCategory3').value;
            $('#categoryModal').modal('hide');
            fetchPlaces(); // 카테고리를 선택하면 장소를 불러옴
        }

        function fetchPlaces() {
            var placesList = document.getElementById('places');
            placesList.innerHTML = ''; // 초기화

            if (selectedCity && selectedCategory3 && selectedProvince) {
                $.ajax({
                    url: '/place/',
                    type: 'GET',
                    data: {
                        'area_code': selectedProvince,
                        'city_code': selectedCity,
                        'category_code': selectedCategory3
                    },
                    success: function(data) {
                        // 데이터가 성공적으로 도착하면, <ul> 리스트를 업데이트합니다
                        var $placeList = $('#place');
                        $placeList.empty(); // 기존의 리스트를 비웁니다

                        $.each(data.places, function(index, place) {
                            var $li = $('<li></li>')
                                .addClass('list-group-item place-item')
                                .attr('data-place-id', index + 1)
                                .text(place.title); // place 객체의 title 속성에 접근합니다
                            $placeList.append($li);
                        });
                        // 항목 클릭 시 selected 클래스 토글
                        $placeList.on('click', '.place-item', function() {
                            $(this).toggleClass('selected');
                            var placeId = $(this).data('place-id');
                            if ($(this).hasClass('selected')) {
                                selectedPlaces.push(placeId);
                            } else {
                                var index = selectedPlaces.indexOf(placeId);
                                if (index > -1) {
                                    selectedPlaces.splice(index, 1);
                                }
                            }
                        });
                    },
                    error: function(xhr, status, error) {
                        console.error('Error fetching places:', error);
                    }
                });
            }
        }

    </script>
</body>
</html>

<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>일차별 장소 선택</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .place-item {
            cursor: pointer;
        }
        .place-item.selected {
            font-weight: bold;
            background-color: #f0f0f0;
        }
        .day-btn {
            margin-right: 5px;
        }
        .day-section {
            display: none;
        }
        .day-section.active {
            display: block;
        }
        .container {
            display: flex;
        }
        .places {
            flex: 1;
        }
        .day-selection {
            flex: 2;
        }
    </style>
</head>
<body>
<div class="container mt-5">
    <div class="places">
        <h3>장소 리스트</h3>
        <ul id="place" class="list-group">

        </ul>
        <button id="addBtn" class="btn btn-primary mt-3">추가</button>
    </div>
    <div class="day-selection">
        <h2>일차별 장소 선택</h2>
        <div class="btn-group" role="group" aria-label="일차 선택">
            <button type="button" class="btn btn-outline-primary day-btn" data-day="1">1일차</button>
            <button type="button" class="btn btn-outline-primary day-btn" data-day="2">2일차</button>
            <button type="button" class="btn btn-outline-primary day-btn" data-day="3">3일차</button>
        </div>

        <button id="addDayBtn" class="btn btn-secondary mt-3">날짜 추가</button>
        <button class="btn btn-danger ml-2" id="deleteActiveDayBtn">삭제</button>

        <div id="day-sections" class="mt-4">
            <!-- 각 일차별 선택한 장소 섹션은 여기에 추가됩니다. -->
        </div>

        <div id="day1" class="day-section active mt-4">
            <h4>1일차 선택한 장소</h4>
            <ul id="selectedPlaces1" class="list-group">
                <!-- 선택한 장소 목록 -->
            </ul>
        </div>

        <div id="day2" class="day-section mt-4">
            <h4>2일차 선택한 장소</h4>
            <ul id="selectedPlaces2" class="list-group">
                <!-- 선택한 장소 목록 -->
            </ul>
        </div>

        <div id="day3" class="day-section mt-4">
            <h4>3일차 선택한 장소</h4>
            <ul id="selectedPlaces3" class="list-group">
                <!-- 선택한 장소 목록 -->
            </ul>
        </div>
    </div>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.3/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script>
    var selectedPlaces = [];
    var dayCount = $('.day-btn').length; // 현재 일차 수 추적

    // 장소 항목 클릭 이벤트
    $('.place-item').click(function() {
        $(this).toggleClass('selected');
        var placeId = $(this).data('place-id');
        if ($(this).hasClass('selected')) {
            selectedPlaces.push(placeId);
        } else {
            var index = selectedPlaces.indexOf(placeId);
            if (index > -1) {
                selectedPlaces.splice(index, 1);
            }
        }
    });

    // 일차 선택 버튼 클릭 이벤트
    $(document).on('click', '.day-btn', function() {
        var day = $(this).data('day');
        $('.day-section').removeClass('active');
        $('#day' + day).addClass('active');
        $('.day-btn').removeClass('active');
        $(this).addClass('active');
    });

    // 추가 버튼 클릭 이벤트
    $('#addBtn').click(function() {
        var day = $('.day-btn.active').data('day');
        var selectedPlacesList = $('#selectedPlaces' + day);
        selectedPlaces.forEach(function(placeId) {
            var placeItem = $('.place-item[data-place-id="' + placeId + '"]').text();
            selectedPlacesList.append('<li class="list-group-item">' + placeItem + '</li>');
        });
        selectedPlaces = [];
        $('.place-item').removeClass('selected');
    });

    // 날짜 추가 버튼 클릭 이벤트
    $('#addDayBtn').click(function() {
        dayCount++;
        var newDayBtn = $('<button type="button" class="btn btn-outline-primary day-btn" data-day="' + dayCount + '">' + dayCount + '일차</button>');
        $('.btn-group').append(newDayBtn);

        var newDaySection = $(
            '<div id="day' + dayCount + '" class="day-section">' +
                '<h4 class="day-title">' + dayCount + '일차 선택한 장소</h4>' +
                '<ul id="selectedPlaces' + dayCount + '" class="list-group"></ul>' +
            '</div>'
        );
        $('#day-sections').append(newDaySection);

        // 일차 버튼 클릭 이벤트 재할당

        newDayBtn.click(function() {
            var day = $(this).data('day');
            $('.day-section').removeClass('active');
            $('#day' + day).addClass('active');
            $('.day-btn').removeClass('active');
            $(this).addClass('active');
        });

    });

$('#deleteActiveDayBtn').click(function() {
    var activeDay = $('.day-btn.active').data('day');
    if (activeDay) {
        var confirmDelete = confirm(activeDay + '일차를 삭제하시겠습니까?');
        if (confirmDelete) {
            $('#day' + activeDay).remove(); // 해당 일차 섹션을 삭제
            $('.day-btn[data-day="' + activeDay + '"]').remove(); // 해당 일차 버튼을 삭제

            // 삭제된 일차 이후의 일차 번호를 조정하고 선택한 장소 리스트 섹션 제목 업데이트
            for (var i = activeDay + 1; i <= dayCount; i++) {
                var $daySection = $('#day' + i);
                var $selectedPlaces = $('#selectedPlaces' + i);

                $daySection.attr('id', 'day' + (i - 1)); // 일차 섹션의 ID 변경
                $selectedPlaces.attr('id', 'selectedPlaces' + (i - 1)); // 선택한 장소 리스트의 ID 변경

                $('.day-btn[data-day="' + i + '"]').attr('data-day', i - 1).text((i - 1) + '일차'); // 일차 버튼의 데이터 및 텍스트 변경
                $daySection.find('.day-title').text((i - 1) + '일차 선택한 장소'); // 선택한 장소 리스트 섹션 제목 변경
            }
            dayCount--;

            // 삭제된 일차가 현재 활성화된 상태였다면, 첫 번째 일차를 활성화 상태로 변경
            if ($('#day' + activeDay).hasClass('active')) {
                $('.day-btn[data-day="1"]').addClass('active');
                $('#day1').addClass('active');
                activeDay = 1; // activeDay 변수를 첫 번째 일차로 초기화
            }
        }
    } else {
        alert('삭제할 일차를 선택해주세요.');
    }
});
</script>
</body>
</html>